@model List<Dat_Ve_Xem_Phim_CGV.Models.SUATCHIEU>
@{
    ViewBag.Title = "Thanh toán";
    Layout = "~/Views/Shared/_Layout1.cshtml";
}

<div class="container mt-4 mb-5">
    <div class="row">
        <!-- Header -->
        <div class="col-12">
            <div class="card bg-dark text-white mb-4">
                <div class="card-body text-center py-3">
                    <h3 class="mb-0 font-weight-bold">THANH TOÁN</h3>
                </div>
            </div>
        </div>


        <div class="col-lg-8">

            <div class="card mb-4">
                <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 font-weight-bold">BƯỚC 1: GIẢM GIÁ</h5>
                    <button class="btn btn-sm btn-outline-light">
                        <i class="fas fa-redo"></i> Đặt lại
                    </button>
                </div>
                <div class="list-group list-group-flush">
                    <a href="#" class="list-group-item list-group-item-action">
                        <i class="fas fa-ticket-alt text-danger mr-2"></i> CGV Voucher
                    </a>
                    <a href="#" class="list-group-item list-group-item-action">
                        <i class="fas fa-tags text-danger mr-2"></i> Mã giảm giá
                    </a>
                    <a href="#" class="list-group-item list-group-item-action">
                        <i class="fas fa-coins text-danger mr-2"></i> Điểm CGV
                    </a>
                    <a href="#" class="list-group-item list-group-item-action">
                        <i class="fas fa-handshake text-danger mr-2"></i> Đối tác
                    </a>
                    <a href="#" class="list-group-item list-group-item-action">
                        <i class="fas fa-gift text-danger mr-2"></i> Mã Khuyến Mãi
                    </a>
                </div>
            </div>


            <div class="card mb-4">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0 font-weight-bold">BƯỚC 2: THẺ QUÀ TẶNG</h5>
                </div>
                <div class="card-body">
                    <div class="form-group mb-0">
                        <input type="text" class="form-control" placeholder="Nhập mã thẻ quà tặng">
                    </div>
                </div>
            </div>


            <div class="card mb-4">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0 font-weight-bold">BƯỚC 3: HÌNH THỨC THANH TOÁN</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">

                        <label class="list-group-item d-flex align-items-center">
                            <input type="radio" name="paymentMethod" value="atm" class="mr-3">
                            <img src="https://e7.pngegg.com/pngimages/147/434/png-clipart-bank-of-montreal-mastercard-debit-card-credit-card-atm-card-mastercard-bank-debit-card.png"
                                 alt="ATM" style="height: 30px;" class="mr-3">
                            <span>ATM card (Thẻ nội địa)</span>
                        </label>


                        <label class="list-group-item d-flex align-items-center">
                            <input type="radio" name="paymentMethod" value="visa" class="mr-3">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRAqP9NzZRcLnpljBpaFWqmYcnv7-7ZvM7-aA&s"
                                 alt="Visa" style="height: 30px;" class="mr-3">
                            <span>Thẻ quốc tế (Visa, Master, JCB)</span>
                        </label>


                        <label class="list-group-item d-flex align-items-center">
                            <input type="radio" name="paymentMethod" value="momo" class="mr-3">
                            <img src="https://upload.wikimedia.org/wikipedia/vi/f/fe/MoMo_Logo.png"
                                 alt="MoMo" style="height: 35px;" class="mr-3">
                            <span>Ví MoMo</span>
                        </label>


                        <label class="list-group-item d-flex align-items-center">
                            <input type="radio" name="paymentMethod" value="zalopay" class="mr-3">
                            <img src="https://cdn.haitrieu.com/wp-content/uploads/2022/10/Logo-ZaloPay.png"
                                 alt="ZaloPay" style="height: 35px;" class="mr-3">
                            <span>Ví ZaloPay</span>
                        </label>


                        <label class="list-group-item d-flex align-items-center">
                            <input type="radio" name="paymentMethod" value="vnpay" class="mr-3">
                            <img src="https://vinadesign.vn/uploads/images/2023/05/vnpay-logo-vinadesign-25-12-57-55.jpg"
                                 alt="VNPay" style="height: 35px;" class="mr-3">
                            <span>VNPAY</span>
                        </label>


                        <label class="list-group-item d-flex align-items-center">
                            <input type="radio" name="paymentMethod" value="shopeepay" class="mr-3">
                            <img src="https://down-vn.img.susercontent.com/file/9263fa8c83628f5deff55e2a90758b06"
                                 alt="ShopeePay" style="height: 35px;" class="mr-3">
                            <span>ShopeePay</span>
                        </label>
                    </div>
                </div>
            </div>


            <div class="card mb-4">
                <div class="card-body">
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" id="agreeTerms" required>
                        <label class="custom-control-label" for="agreeTerms">
                            Tôi đồng ý với <a href="#" class="text-danger">điều khoản sử dụng</a>
                            và mua vé cho người có độ tuổi phù hợp
                        </label>
                    </div>
                </div>
            </div>
        </div>


        <div class="col-lg-4">

            <div class="card mb-3">
                <div class="card-header bg-warning text-dark text-center font-weight-bold">
                    THÔNG TIN VÉ
                </div>
                <div class="card-body">
                    <h6 class="font-weight-bold text-danger">@ViewBag.TenPhim</h6>
                    <hr>
                    <p class="mb-1"><i class="fas fa-map-marker-alt text-danger mr-2"></i><strong>Rạp:</strong> @ViewBag.TenRap</p>
                    @*<p class="mb-1"><i class="fas fa-door-open text-danger mr-2"></i><strong>Phòng:</strong> @ViewBag.TenPhong</p>*@
                    <p class="mb-1"><i class="fas fa-calendar text-danger mr-2"></i><strong>Ngày:</strong> @ViewBag.NgayChieu</p>
                    <p class="mb-1"><i class="fas fa-clock text-danger mr-2"></i><strong>Giờ:</strong> @ViewBag.GioChieu</p>
                    <p class="mb-0"><i class="fas fa-couch text-danger mr-2"></i><strong>Ghế:</strong> @ViewBag.SeatIds</p>
                </div>
            </div>


            <div class="card mb-3">
                <div class="card-header bg-warning text-dark text-center font-weight-bold">
                    TỔNG CỘNG
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Tiền vé (@ViewBag.SoGhe ghế)</span>
                        <span class="font-weight-bold">@String.Format("{0:N0}", ViewBag.TongTien) ₫</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Combo</span>
                        <span class="font-weight-bold">0 ₫</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between">
                        <span class="font-weight-bold">Tổng:</span>
                        <span class="font-weight-bold text-dark">@String.Format("{0:N0}", ViewBag.TongTien) ₫</span>
                    </div>
                </div>
            </div>


            <div class="card mb-3">
                <div class="card-header bg-warning text-dark text-center font-weight-bold">
                    KHUYẾN MÃI
                </div>
                <div class="card-body text-center">
                    <h4 class="text-success font-weight-bold mb-0">0 ₫</h4>
                </div>
            </div>


            <div class="card mb-3">
                <div class="card-header bg-danger text-white text-center font-weight-bold">
                    TỔNG SỐ TIỀN THANH TOÁN
                </div>
                <div class="card-body text-center">
                    <h3 class="text-danger font-weight-bold mb-0">
                        @String.Format("{0:N0}", ViewBag.TongTien) ₫
                    </h3>
                </div>
            </div>


            <div class="card mb-3">
                <div class="card-header bg-warning text-dark text-center font-weight-bold">
                    THỜI GIAN GIỮ GHẾ
                </div>
                <div class="card-body text-center py-4">
                    <div class="d-flex justify-content-center align-items-center">
                        <div class="mx-3">
                            <div class="bg-danger text-white rounded p-3" style="width: 70px; height: 70px; display: flex; align-items: center; justify-content: center;">
                                <span class="h1 mb-0" id="minutes">5</span>
                            </div>
                            <small class="d-block mt-2">Phút</small>
                        </div>
                        <div class="mx-3">
                            <div class="bg-danger text-white rounded p-3" style="width: 70px; height: 70px; display: flex; align-items: center; justify-content: center;">
                                <span class="h1 mb-0" id="seconds">00</span>
                            </div>
                            <small class="d-block mt-2">Giây</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-9 text-right">
                    <button class="btn btn-danger btn-lg font-weight-bold" id="btnThanhToan">
                        <i class="fas fa-credit-card mr-2"></i> Thanh toán
                    </button>
                </div>
                <div class="col-3 text-left">
                    <button class="btn btn-secondary btn-lg font-weight-bold" id="btnQuayLai">
                        <i class="fas fa-credit-card mr-2"></i> Quay lại
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>

        let timeLeft = 300; // 5 phút = 300 giây

        function updateCountdown() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;

            document.getElementById('minutes').textContent = minutes;
            document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');

            if (timeLeft <= 0) {
                alert('Hết thời gian giữ ghế! Vui lòng đặt lại.');
                window.location.href = '@Url.Action("Index", "MuaVe")';
                return;
            }

            timeLeft--;
        }

        // Cập nhật mỗi giây
        setInterval(updateCountdown, 1000);
        updateCountdown();

        // Xử lý thanh toán
        document.getElementById('btnThanhToan').addEventListener('click', function () {
            const agreeTerms = document.getElementById('agreeTerms').checked;
            const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked');

            if (!agreeTerms) {
                alert('Vui lòng đồng ý với điều khoản sử dụng!');
                return;
            }

            if (!paymentMethod) {
                alert('Vui lòng chọn hình thức thanh toán!');
                return;
            }

            // window.location.href = '@Url.Action("XuLyThanhToan", "ChonGhe")';
            alert('Đang xử lý thanh toán...');
        });
        //Xử lý quay lại
        document.getElementById('btnQuayLai').addEventListener('click', function () {
            window.location.href = '@Url.Action("Index", "ChonGhe", new {maSuatChieu = ViewBag.MaSuatChieu})';
        });
    </script>
}

<style>
    .list-group-item {
        cursor: pointer;
        transition: all 0.3s;
    }

        .list-group-item:hover {
            background-color: #f8f9fa;
            transform: translateX(5px);
        }

        .list-group-item input[type="radio"] {
            cursor: pointer;
        }

    .card-header {
        font-size: 0.95rem;
    }
</style>